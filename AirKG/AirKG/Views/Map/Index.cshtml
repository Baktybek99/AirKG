@using AirKG.ViewModels.Markers;
@model MapModel

<div style="position: relative;">
    <div class="big_block">
        @foreach (var index in Model.Sensors)
        {
            <button data-bs-toggle="modal" data-bs-target="#staticBackdrop" data-action=@index.Id class="map-marker" href="#" style="position: absolute; left: @HTMLstatic.GetCore(index.Latitude)px; top: @HTMLstatic.GetCore(index.Longitude)px;">
                <span class="tooltiptext">@index.AirQuality</span>
            </button>
        }
        <svg class="b-map-svg" version="1.0" xmlns="http://www.w3.org/2000/svg"
             width="200mm" height="200mm" viewBox="0 0 300.000000 1000.000000"
             preserveAspectRatio="xMidYMid meet">

            <g class="area1" stroke="red" stroke-width="20"
               transform="translate(88,527.000000) scale(0.078000,-0.0780000)"
               fill="#000000">

                <path d="M2410 4396 c0 -7 7 -31 16 -52 14 -34 16 -66 10 -234 -8 -236 -15
                            -315 -30 -336 -12 -15 -202 -44 -489 -75 -65 -7 -124 -17 -132 -23 -10 -8 -19
                            -82 -35 -276 -13 -146 -23 -266 -24 -267 -1 -1 -51 -5 -111 -9 -88 -5 -114
                            -10 -128 -25 -17 -18 -40 -19 -395 -19 l-377 0 -219 -40 c-120 -21 -220 -41
                            -222 -43 -3 -3 10 -225 29 -478 3 -37 10 -53 35 -75 31 -29 31 -30 39 -159 l8
                            -130 25 2 c14 1 187 7 385 13 l360 11 325 59 c179 32 359 64 400 70 42 7 84
                            20 95 30 39 34 136 90 156 90 11 0 70 -11 131 -25 61 -14 116 -25 122 -25 7 0
                            17 33 24 77 6 42 13 77 14 78 2 2 81 4 177 6 l175 4 -2 -165 c-1 -91 -7 -474
                            -14 -851 -6 -377 -9 -693 -6 -701 5 -13 56 -16 335 -22 180 -4 337 -9 349 -12
                            20 -5 21 -1 27 168 4 95 7 254 7 353 0 99 7 340 15 535 8 195 17 432 21 525 4
                            94 11 176 16 182 6 7 8 19 5 26 -4 11 -57 16 -244 21 -131 4 -238 8 -239 9 0
                            1 3 270 7 597 7 532 6 598 -8 619 -13 21 -15 49 -10 185 5 155 7 163 38 226
                            17 36 40 77 50 92 23 32 24 64 3 72 -9 3 -173 6 -365 6 -290 0 -349 -2 -349
                            -14z" />
            </g>
            <g class="area2 example" stroke="red" stroke-width="20"
               transform="translate(247,779) scale(0.108000,-0.108000)">
                <path d="M1435 3640 c-38 -4 -95 -22 -153 -48 -89 -40 -97 -42 -191 -42 l-98
                            0 -7 -162 c-3 -90 -9 -220 -12 -290 l-7 -128 -228 0 -229 0 0 -42 c-1 -24 -11
                            -275 -24 -558 -13 -283 -23 -516 -21 -518 1 -2 27 3 56 10 49 13 56 18 73 56
                            11 23 24 42 30 42 19 0 56 -30 56 -46 0 -17 -14 -18 171 11 l155 24 113 -39
                            c116 -41 143 -45 274 -34 l76 7 -6 27 c-3 20 3 42 22 74 15 25 31 48 36 52 5
                            3 59 14 120 24 62 11 114 22 117 25 3 3 -22 121 -56 263 -34 141 -63 266 -64
                            277 -3 17 9 22 102 42 58 13 116 26 128 29 l24 5 -8 304 -7 305 59 0 c36 0
                            196 -30 409 -75 l350 -76 458 -204 457 -203 -6 46 c-3 26 -25 211 -48 412 -42
                            363 -42 365 -66 372 -14 4 -317 21 -675 38 -638 30 -1214 39 -1380 20z" />
            </g>
            <g class="area3 example" transform="translate(299,569) scale(0.09,-0.100000)" stroke="red" stroke-width="20"
               fill="aqua">
                <path d="M550 3805 c0 -32 -9 -61 -31 -101 -29 -50 -31 -60 -23 -97 5 -23 6
                            -75 3 -116 -5 -67 -8 -77 -37 -102 -27 -24 -41 -29 -87 -29 -30 0 -56 -1 -56
                            -2 -4 -8 -26 -924 -22 -930 2 -5 85 -8 184 -8 l179 0 -4 -22 c-3 -13 -8 -138
                            -11 -278 -3 -140 -8 -288 -11 -329 l-7 -73 149 7 c145 7 152 8 259 51 98 40
                            125 46 250 58 204 20 818 6 1850 -43 948 -46 945 -45 945 -30 0 6 -7 8 -16 5
                            -8 -3 -13 -2 -10 2 5 8 -12 17 -127 63 -41 16 -56 27 -53 38 2 9 7 39 11 66 4
                            28 18 95 31 149 13 55 23 100 21 101 -12 8 -1025 317 -1062 325 -199 42 -633
                            143 -647 150 -10 6 -57 10 -105 10 -80 0 -226 10 -361 26 -50 5 -52 6 -46 32
                            4 15 18 53 31 86 13 32 22 64 19 72 -3 7 -24 14 -48 16 l-43 3 -14 133 c-12
                            110 -12 139 -1 172 7 22 11 43 7 46 -3 3 -46 16 -96 29 l-91 23 0 -125 c0
                            -109 4 -141 35 -263 19 -76 35 -141 35 -144 0 -4 -47 -6 -104 -6 -94 0 -105 2
                            -111 19 -6 20 -43 31 -104 31 -62 0 -65 7 -48 91 15 73 15 74 -9 128 -22 48
                            -25 66 -23 150 l2 96 -65 116 -66 115 19 165 c10 90 19 165 19 167 0 1 -115 2
                            -255 2 l-255 0 0 -45z" />
            </g>

            <g class="area4 example" transform="translate(0.000000,743) scale(0.100000,-0.100000)" stroke="red" stroke-width="20"
               fill="gray">
                <path d="M2808 4153 c-27 -4 -28 -6 -44 -95 -3 -21 -9 -38 -13 -38 -4 0 -47 9
                            -97 20 l-89 20 -65 -44 -65 -44 -280 -46 c-187 -30 -326 -47 -420 -51 -77 -3
                            -225 -10 -330 -16 -104 -5 -203 -11 -220 -11 -16 -1 -56 2 -88 6 l-58 8 5 -58
                            c3 -33 8 -110 11 -171 6 -107 5 -113 -13 -113 -23 0 -32 18 -32 68 0 73 -4 77
                            -70 74 -44 -3 -59 -8 -62 -20 -8 -29 2 -42 32 -42 24 0 28 -5 34 -37 12 -75 8
                            -77 -46 -13 -46 56 -54 61 -82 56 -70 -12 -327 -39 -331 -34 -3 2 -8 32 -11
                            66 -7 61 -7 62 -41 68 -27 5 -39 2 -56 -14 -19 -18 -30 -20 -80 -15 -32 3 -60
                            10 -63 14 -3 5 -16 9 -30 9 -25 0 -25 -1 -17 -57 4 -32 8 -130 7 -218 0 -138
                            -7 -211 -53 -530 -29 -203 -55 -394 -58 -424 -6 -54 -6 -54 18 -46 27 8 240
                            36 251 32 3 -1 48 -54 98 -117 l92 -115 91 -5 91 -5 12 -48 c7 -27 14 -50 16
                            -52 2 -2 93 14 203 37 l199 40 146 131 c162 146 156 136 159 292 1 69 5 76 51
                            110 26 19 46 25 87 25 l53 0 0 -63 0 -62 115 4 115 3 1 -28 c1 -16 1 -94 0
                            -174 l-2 -145 -35 -31 -34 -31 10 -54 c23 -116 36 -124 209 -132 68 -3 126 -8
                            128 -11 3 -2 11 -34 20 -70 10 -45 19 -66 29 -66 8 0 41 -18 74 -40 63 -43 77
                            -70 65 -132 l-7 -34 90 4 89 4 22 -30 c11 -17 24 -51 27 -76 5 -36 11 -46 26
                            -46 23 0 38 -37 38 -93 0 -50 2 -52 63 -101 42 -34 47 -43 47 -78 0 -27 10
                            -59 30 -93 35 -60 47 -65 172 -65 72 0 79 2 73 18 -9 22 -24 189 -25 268 0 59
                            2 63 40 97 25 23 60 42 97 52 32 9 87 25 123 35 36 11 83 21 105 24 92 11 146
                            23 157 34 9 9 15 5 24 -18 12 -28 17 -30 64 -30 28 0 60 5 71 10 22 12 141 0
                            296 -31 86 -17 108 -18 143 -8 22 7 40 15 39 18 0 3 -24 26 -52 51 l-52 45
                            -90 -6 c-73 -5 -100 -2 -144 13 -30 10 -62 18 -73 18 -10 0 -42 14 -71 30 -30
                            17 -65 30 -79 30 -15 0 -98 -11 -185 -25 -198 -31 -193 -31 -193 1 0 29 -16
                            48 -47 58 -18 6 -26 -1 -48 -43 -30 -54 -39 -60 -102 -71 l-43 -7 0 51 c0 28
                            5 105 11 171 6 66 10 154 9 195 -1 41 4 206 9 365 6 160 20 576 31 925 11 349
                            22 668 24 708 l4 72 -111 -1 c-62 -1 -124 -4 -139 -6z" />
            </g>
        </svg>
    </div>
</div>


<!-- Modal -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">Modal title</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                ...
                <div id="ChartView">
                    <canvas id="myChart"></canvas>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Understood</button>
            </div>
        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

@section scripts
{
    <script type="text/javascript">
        $(document).ready(function () {
            function OnError(err) {

            }

            $('.map-marker').click(function () {

                var chartView = document.getElementById('ChartView');

                chartView.innerHTML = '&nbsp;';
                var sensorId = $(this).data('action');
                console.log(sensorId);
                $("#ChartView").append('<canvas id="myChart" style="max-height:500px;max-width:1000px"></canvas>')
                $.ajax({
                    type: "GET",
                    url: `/Chart/GetResult?sensorId=${sensorId}`,
                    data: "",
                    contentType: "application/json: charset=utf-8",
                    dataType: "json",
                    success: OnSuccesResult,
                    error: OnError
                })

                function OnSuccesResult(data) {
                    var _data = data;
                    var _chartLabels = _data[0];
                    var _chartData = _data[1];

                    new Chart("myChart", {
                        type: 'bar',
                        data: {
                            labels: _chartLabels,
                            datasets: [{
                                label: 'My Dataset',
                                data: _chartData,
                                backgroundColor: function (context) {
                                    var value = context.dataset.data[context.dataIndex];
                                    if (value <= 15) {
                                        return 'Blue';
                                    } else if (value >= 16 && value <= 35) {
                                        return 'Green';
                                    } else if (value >= 36 && value <= 75) {
                                        return 'Yellow';
                                    } else if (value >= 76 && value <= 100) {
                                        return 'Red';
                                    } else {
                                        return 'Black'
                                    }
                                }
                            }]
                        }
                    });

                    console.log("Finish All");
                }
            })

        })
    </script>
}

